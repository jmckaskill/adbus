<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>adbus: adbus_Proxy Struct Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li class="current"><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="functions.html"><span>Data&nbsp;Fields</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>adbus_Proxy Struct Reference</h1><!-- doxytag: class="adbus_Proxy" -->
<p>Helper class to access members of a specific remote object.  
<a href="#_details">More...</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Related Functions</h2></td></tr>
<tr><td colspan="2"><p>(Note that these are not member functions.) </p>
<br/><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="afead6b6fb26528fb2b5ecb02c54380e8"></a><!-- doxytag: member="adbus_Proxy::adbus_proxy_new" ref="afead6b6fb26528fb2b5ecb02c54380e8" args="(adbus_State *state)" -->
<a class="el" href="structadbus__Proxy.html">adbus_Proxy</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structadbus__Proxy.html#afead6b6fb26528fb2b5ecb02c54380e8">adbus_proxy_new</a> (<a class="el" href="structadbus__State.html">adbus_State</a> *state)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create a new proxy tied to the provided state. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a00bf8652ebb5f8d5b043f63b710db4ae"></a><!-- doxytag: member="adbus_Proxy::adbus_proxy_free" ref="a00bf8652ebb5f8d5b043f63b710db4ae" args="(adbus_Proxy *p)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structadbus__Proxy.html#a00bf8652ebb5f8d5b043f63b710db4ae">adbus_proxy_free</a> (<a class="el" href="structadbus__Proxy.html">adbus_Proxy</a> *p)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Frees the proxy. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="afb7b7482b19141aab55dd61f50719245"></a><!-- doxytag: member="adbus_Proxy::adbus_proxy_init" ref="afb7b7482b19141aab55dd61f50719245" args="(adbus_Proxy *p, adbus_Connection *connection, const char *service, int ssize, const char *path, int psize)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structadbus__Proxy.html#afb7b7482b19141aab55dd61f50719245">adbus_proxy_init</a> (<a class="el" href="structadbus__Proxy.html">adbus_Proxy</a> *p, <a class="el" href="structadbus__Connection.html">adbus_Connection</a> *connection, const char *service, int ssize, const char *path, int psize)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Reset and reinitialise the proxy. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a121dcfe8ad315438ac0be33d50682db2"></a><!-- doxytag: member="adbus_Proxy::adbus_proxy_setinterface" ref="a121dcfe8ad315438ac0be33d50682db2" args="(adbus_Proxy *p, const char *interface, int isize)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structadbus__Proxy.html#a121dcfe8ad315438ac0be33d50682db2">adbus_proxy_setinterface</a> (<a class="el" href="structadbus__Proxy.html">adbus_Proxy</a> *p, const char *interface, int isize)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set the proxy interface. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af351e355022682dc761a617b0c376e0e"></a><!-- doxytag: member="adbus_Proxy::adbus_proxy_signal" ref="af351e355022682dc761a617b0c376e0e" args="(adbus_Proxy *p, adbus_Match *m, const char *signal, int size)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structadbus__Proxy.html#af351e355022682dc761a617b0c376e0e">adbus_proxy_signal</a> (<a class="el" href="structadbus__Proxy.html">adbus_Proxy</a> *p, <a class="el" href="structadbus__Match.html">adbus_Match</a> *m, const char *signal, int size)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add a signal match. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a721447774cea013f5439c5c77ba6a854"></a><!-- doxytag: member="adbus_Proxy::adbus_call_method" ref="a721447774cea013f5439c5c77ba6a854" args="(adbus_Proxy *p, adbus_Call *call, const char *method, int size)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structadbus__Proxy.html#a721447774cea013f5439c5c77ba6a854">adbus_call_method</a> (<a class="el" href="structadbus__Proxy.html">adbus_Proxy</a> *p, adbus_Call *call, const char *method, int size)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Setup an adbus_Call structure for a method call. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4269ef37cf58ebef0128988ffd42e96b"></a><!-- doxytag: member="adbus_Proxy::adbus_call_setproperty" ref="a4269ef37cf58ebef0128988ffd42e96b" args="(adbus_Proxy *p, adbus_Call *call, const char *property, int propsize, const char *type, int typesize)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structadbus__Proxy.html#a4269ef37cf58ebef0128988ffd42e96b">adbus_call_setproperty</a> (<a class="el" href="structadbus__Proxy.html">adbus_Proxy</a> *p, adbus_Call *call, const char *property, int propsize, const char *type, int typesize)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Setup an adbus_Call structure to set a property. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a74667f9dd05b6ba4b2544c09db176c2a"></a><!-- doxytag: member="adbus_Proxy::adbus_call_getproperty" ref="a74667f9dd05b6ba4b2544c09db176c2a" args="(adbus_Proxy *p, adbus_Call *call, const char *property, int size)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structadbus__Proxy.html#a74667f9dd05b6ba4b2544c09db176c2a">adbus_call_getproperty</a> (<a class="el" href="structadbus__Proxy.html">adbus_Proxy</a> *p, adbus_Call *call, const char *property, int size)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Setup an adbus_Call structure to get a property. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aae5240912dfc5f7759b72ca4cd921dcf"></a><!-- doxytag: member="adbus_Proxy::adbus_call_send" ref="aae5240912dfc5f7759b72ca4cd921dcf" args="(adbus_Proxy *p, adbus_Call *call)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structadbus__Proxy.html#aae5240912dfc5f7759b72ca4cd921dcf">adbus_call_send</a> (<a class="el" href="structadbus__Proxy.html">adbus_Proxy</a> *p, adbus_Call *call)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send off a call. <br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Helper class to access members of a specific remote object. </p>
<p><a class="el" href="structadbus__Proxy.html" title="Helper class to access members of a specific remote object.">adbus_Proxy</a> acts as a simple wrapper around a specific remote object to ease calling methods, setting/getting properties, and adding matches for signals on that object.</p>
<p>All callbacks are registered with a provided <a class="el" href="structadbus__State.html" title="Helper class to manage connection services (binds, matches and replies).">adbus_State</a> and their lifetime is tied to the state not the proxy. This means that the proxy can be modified, freed, reset, etc without losing the original callbacks.</p>
<p>The user can optionally set the interface, but this is required for accessing properties and signals.</p>
<dl class="warning"><dt><b>Warning:</b></dt><dd>Only one adbus_Call can be active at a time. </dd>
<dd>
The proxy can only be used from the creating thread and must be on the same thread as the associated state.</dd></dl>
<h2><a class="anchor" id="methods">
Methods</a></h2>
<p>Method calling uses a helper class adbus_Call. The general workflow is:</p>
<ol type="1">
<li>Create an adbus_Call on the stack.</li>
<li>Call <a class="el" href="structadbus__Proxy.html#a721447774cea013f5439c5c77ba6a854" title="Setup an adbus_Call structure for a method call.">adbus_call_method()</a> to setup the fields in the adbus_Call.</li>
<li>Setup arguments and callbacks in the adbus_Call fields.</li>
<li>Call <a class="el" href="structadbus__Proxy.html#aae5240912dfc5f7759b72ca4cd921dcf" title="Send off a call.">adbus_call_send()</a> to send off the message and register for any callbacks.</li>
</ol>
<p>For example: </p>
<div class="fragment"><pre class="fragment">  <span class="keyword">struct </span>my_state
  {
      <a class="code" href="structadbus__State.html" title="Helper class to manage connection services (binds, matches and replies).">adbus_State</a>* state;
      <a class="code" href="structadbus__Proxy.html" title="Helper class to access members of a specific remote object.">adbus_Proxy</a>* proxy;
  };

  <span class="keyword">struct </span>my_state* CreateMyState(<a class="code" href="structadbus__Connection.html" title="Client message dispatcher.">adbus_Connection</a>* c)
  {
      <span class="keyword">struct </span>my_state* ret = (<span class="keyword">struct </span>my_state*) calloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> my_state), 1);
      ret-&gt;state = adbus_state_new();
      ret-&gt;proxy = <a class="code" href="structadbus__Proxy.html#afead6b6fb26528fb2b5ecb02c54380e8" title="Create a new proxy tied to the provided state.">adbus_proxy_new</a>(ret-&gt;state);

      <a class="code" href="structadbus__Proxy.html#afb7b7482b19141aab55dd61f50719245" title="Reset and reinitialise the proxy.">adbus_proxy_init</a>(ret-&gt;proxy, c, <span class="stringliteral">&quot;com.example.ExampleService&quot;</span>, -1, <span class="stringliteral">&quot;/&quot;</span>, -1);

      <span class="comment">// This is required for properties and signals, but not calling methods.</span>
      <a class="code" href="structadbus__Proxy.html#a121dcfe8ad315438ac0be33d50682db2" title="Set the proxy interface.">adbus_proxy_setinterface</a>(ret-&gt;proxy, <span class="stringliteral">&quot;com.example.ExampleInterface&quot;</span>, -1);

      <span class="keywordflow">return</span> ret;
  }

  <span class="keywordtype">void</span> DeleteMyState(<span class="keyword">struct</span> my_state* s)
  {
      <span class="keywordflow">if</span> (s) {
          <a class="code" href="structadbus__Proxy.html#a00bf8652ebb5f8d5b043f63b710db4ae" title="Frees the proxy.">adbus_proxy_free</a>(s-&gt;proxy);
          adbus_state_free(s-&gt;state);
          free(s);
      }
  }

  <span class="keywordtype">int</span> Reply(<a class="code" href="structadbus__CbData.html" title="Data structure used for message callbacks.">adbus_CbData</a>* d)
  {
      <span class="keyword">struct </span>my_state* s = (<span class="keyword">struct </span>my_state*) d-&gt;<a class="code" href="structadbus__CbData.html#add762ce3f14ba8978cbcd17d74d6232f" title="First user data variable.">user1</a>;
      <span class="comment">// Do something</span>
      <span class="keywordflow">return</span> 0;
  }

  <span class="keywordtype">void</span> CallMethod(<span class="keyword">struct</span> my_state* s)
  {
      adbus_Call call;

      <span class="comment">// Setup the call</span>
      adbus_proxy_method(s-&gt;proxy, <span class="stringliteral">&quot;ExampleMethod&quot;</span>, -1);

      <span class="comment">// Append some arguments</span>
      <a class="code" href="adbus_8h.html#a8077dc6fe22d8c839492e747c4dab19e" title="Sets the argument signature (see adbus_buf_setsig()).">adbus_msg_setsig</a>(call.msg, <span class="stringliteral">&quot;b&quot;</span>, -1);
      <a class="code" href="adbus_8h.html#ad287ccbdde954a0542f3c8b2e941f6a4" title="Appends a boolean to the argument data (see adbus_buf_bool()).">adbus_msg_bool</a>(call.msg, 1);

      <span class="comment">// Setup callbacks</span>
      call.callback = &amp;Reply;
      call.cuser = s;

      <span class="comment">// Send off the call</span>
      <a class="code" href="structadbus__Proxy.html#aae5240912dfc5f7759b72ca4cd921dcf" title="Send off a call.">adbus_call_send</a>(s-&gt;proxy, &amp;call);
  }
</pre></div><h2><a class="anchor" id="properties">
Properties</a></h2>
<dl class="note"><dt><b>Note:</b></dt><dd>This requires that the interface be set with <a class="el" href="structadbus__Proxy.html#a121dcfe8ad315438ac0be33d50682db2" title="Set the proxy interface.">adbus_proxy_setinterface()</a>.</dd></dl>
<p>The workflow for getting/setting properties is very similar to calling methods:</p>
<ol type="1">
<li>Create an adbus_Call on the stack</li>
<li>Call <a class="el" href="structadbus__Proxy.html#a4269ef37cf58ebef0128988ffd42e96b" title="Setup an adbus_Call structure to set a property.">adbus_call_setproperty()</a> and <a class="el" href="structadbus__Proxy.html#a74667f9dd05b6ba4b2544c09db176c2a" title="Setup an adbus_Call structure to get a property.">adbus_call_getproperty()</a> to setup the adbus_Call.</li>
<li>Append the property to adbus_Call::msg for <a class="el" href="structadbus__Proxy.html#a4269ef37cf58ebef0128988ffd42e96b" title="Setup an adbus_Call structure to set a property.">adbus_call_setproperty()</a>. Add callbacks for <a class="el" href="structadbus__Proxy.html#a74667f9dd05b6ba4b2544c09db176c2a" title="Setup an adbus_Call structure to get a property.">adbus_call_getproperty()</a>.</li>
<li>Send off the call using <a class="el" href="structadbus__Proxy.html#aae5240912dfc5f7759b72ca4cd921dcf" title="Send off a call.">adbus_call_send()</a>.</li>
</ol>
<dl class="note"><dt><b>Note:</b></dt><dd>When appending the property to the message you should not set the argument signature.</dd></dl>
<p>For example: </p>
<div class="fragment"><pre class="fragment">  <span class="keywordtype">void</span> SetProperty(<span class="keyword">struct</span> my_state* s)
  {
      adbus_Call call;

      <span class="comment">// Setup the call</span>
      adbus_proxy_setproperty(s-&gt;proxy, &amp;call, <span class="stringliteral">&quot;BooleanProperty&quot;</span>, -1, <span class="stringliteral">&quot;b&quot;</span>, -1);

      <span class="comment">// Append the argument</span>
      <a class="code" href="adbus_8h.html#ad287ccbdde954a0542f3c8b2e941f6a4" title="Appends a boolean to the argument data (see adbus_buf_bool()).">adbus_msg_bool</a>(call.msg, 1);

      <span class="comment">// Send off the call</span>
      <a class="code" href="structadbus__Proxy.html#aae5240912dfc5f7759b72ca4cd921dcf" title="Send off a call.">adbus_call_send</a>(s-&gt;proxy, &amp;call);
  }

  <span class="keywordtype">void</span> GetProperty(<span class="keyword">struct</span> my_state* s)
  {
      adbus_Call call;

      <span class="comment">// Setup the call</span>
      adbus_proxy_getproperty(s-&gt;proxy, &amp;call, <span class="stringliteral">&quot;BooleanProperty&quot;</span>, -1);

      <span class="comment">// Set the callback</span>
      call.callback = &amp;Reply;
      call.cuser = s;

      <span class="comment">// Send off the call</span>
      <a class="code" href="structadbus__Proxy.html#aae5240912dfc5f7759b72ca4cd921dcf" title="Send off a call.">adbus_call_send</a>(s-&gt;proxy, &amp;call);
  }
</pre></div><h2><a class="anchor" id="signals">
Signals</a></h2>
<dl class="note"><dt><b>Note:</b></dt><dd>This requires that the interface be set with <a class="el" href="structadbus__Proxy.html#a121dcfe8ad315438ac0be33d50682db2" title="Set the proxy interface.">adbus_proxy_setinterface()</a>.</dd></dl>
<p>The proxy can also add signal matches through to the state for this remote object.</p>
<p>The workflow is:</p>
<ol type="1">
<li>Create a match on the stack and initialise it using adbus_match_init().</li>
<li>Set the callback in the match</li>
<li>Call <a class="el" href="structadbus__Proxy.html#af351e355022682dc761a617b0c376e0e" title="Add a signal match.">adbus_proxy_signal()</a> which will setup the remaining items and add it to the state.</li>
</ol>
<p>For example: </p>
<div class="fragment"><pre class="fragment">  <span class="keywordtype">int</span> OnSignal(<a class="code" href="structadbus__CbData.html" title="Data structure used for message callbacks.">adbus_CbData</a>* d)
  {
      <span class="keyword">struct </span>my_state* s = (<span class="keyword">struct </span>my_state*) d-&gt;<a class="code" href="structadbus__CbData.html#add762ce3f14ba8978cbcd17d74d6232f" title="First user data variable.">user1</a>;
      <span class="comment">// Do something</span>
      <span class="keywordflow">return</span> 0;
  }
  <span class="keywordtype">void</span> AddSignalMatch(<span class="keyword">struct</span> my_state* s)
  {
      <a class="code" href="structadbus__Match.html" title="Data structure used to register general matches.">adbus_Match</a> m;
      adbus_match_init(&amp;m);
      m.<a class="code" href="structadbus__Match.html#a80a7a68c949940fe1229f5b2e067b108" title="Function to call when a message matches the supplied fields.">callback</a>  = &amp;OnSignal;
      m.<a class="code" href="structadbus__Match.html#aeb9a122878c7b6ff8bbb81077180a924" title="User data for the adbus_Match::callback function.">cuser</a>     = s;
      <a class="code" href="structadbus__Proxy.html#af351e355022682dc761a617b0c376e0e" title="Add a signal match.">adbus_proxy_signal</a>(s-&gt;proxy, &amp;m, <span class="stringliteral">&quot;ExampleSignal&quot;</span>, -1);
  }
</pre></div><dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="structadbus__State.html" title="Helper class to manage connection services (binds, matches and replies).">adbus_State</a> </dd></dl>
<hr/>The documentation for this struct was generated from the following file:<ul>
<li>adbus/proxy.c</li>
</ul>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on Mon Mar 22 00:10:02 2010 for adbus by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
