<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>adbus: adbus_State Struct Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li class="current"><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="functions.html"><span>Data&nbsp;Fields</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>adbus_State Struct Reference</h1><!-- doxytag: class="adbus_State" -->
<p>Helper class to manage connection services (binds, matches and replies).  
<a href="#_details">More...</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Related Functions</h2></td></tr>
<tr><td colspan="2"><p>(Note that these are not member functions.) </p>
<br/><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structadbus__State.html#a96888088138e535b9437b2b1d8d4c7c7">adbus_state_bind</a> (<a class="el" href="structadbus__State.html">adbus_State</a> *s, <a class="el" href="structadbus__Connection.html">adbus_Connection</a> *c, const <a class="el" href="structadbus__Bind.html">adbus_Bind</a> *b)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Adds a binding to the supplied connection.  <a href="#a96888088138e535b9437b2b1d8d4c7c7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structadbus__State.html#acdd34e51f63d21698954854c140f49b3">adbus_state_addmatch</a> (<a class="el" href="structadbus__State.html">adbus_State</a> *s, <a class="el" href="structadbus__Connection.html">adbus_Connection</a> *c, const <a class="el" href="structadbus__Match.html">adbus_Match</a> *m)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Adds a match to the supplied connection.  <a href="#acdd34e51f63d21698954854c140f49b3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structadbus__State.html#a66d239bfac789558e23ad20bd2ead98f">adbus_state_addreply</a> (<a class="el" href="structadbus__State.html">adbus_State</a> *s, <a class="el" href="structadbus__Connection.html">adbus_Connection</a> *c, const <a class="el" href="structadbus__Reply.html">adbus_Reply</a> *r)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Adds a reply to the supplied connection.  <a href="#a66d239bfac789558e23ad20bd2ead98f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structadbus__State.html#a8acf9818f655368f1399257a05f5aa62">adbus_state_reset</a> (<a class="el" href="structadbus__State.html">adbus_State</a> *s)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Resets the state, removing all services.  <a href="#a8acf9818f655368f1399257a05f5aa62"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac47884342f82ecf834948ef0f382950d"></a><!-- doxytag: member="adbus_State::adbus_state_free" ref="ac47884342f82ecf834948ef0f382950d" args="(adbus_State *s)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structadbus__State.html#ac47884342f82ecf834948ef0f382950d">adbus_state_free</a> (<a class="el" href="structadbus__State.html">adbus_State</a> *s)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Frees the state, removing all services. <br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Helper class to manage connection services (binds, matches and replies). </p>
<p><a class="el" href="structadbus__State.html" title="Helper class to manage connection services (binds, matches and replies).">adbus_State</a> provides two benefits over using the connection services directly:</p>
<ol type="1">
<li>The connection services can only be added and removed on the connection thread (using adbus_conn_addreply(), adbus_conn_bind(), etc). An <a class="el" href="structadbus__State.html" title="Helper class to manage connection services (binds, matches and replies).">adbus_State</a> instance acts as a proxy from the local thread to one or more connection threads managing the thread jumping needed to register/unregister services.</li>
<li>Keeps track of services as the connection removes them, so that the remaining services can be removed in a single call.</li>
</ol>
<p>The general idea is to keep an <a class="el" href="structadbus__State.html" title="Helper class to manage connection services (binds, matches and replies).">adbus_State</a> associated with any callback data (ie the local object, data structure, etc). Thus when the local object gets destroyed it simply needs to reset or free the state and all remaining callbacks are cleared out.</p>
<p>Some points to note:</p>
<ul>
<li>An <a class="el" href="structadbus__State.html" title="Helper class to manage connection services (binds, matches and replies).">adbus_State</a> can handle services for any number of connections.</li>
<li>Each <a class="el" href="structadbus__State.html" title="Helper class to manage connection services (binds, matches and replies).">adbus_State</a> is designed to be used from the thread it was created from. Specifically the client API can only be called from the thread that created the state, and all connection services will be setup to proxy messages to/from the thread it was created on.</li>
<li>Connection services can not set their proxy callbacks, as this is overwritten by <a class="el" href="structadbus__State.html" title="Helper class to manage connection services (binds, matches and replies).">adbus_State</a> internally to proxy all messages to the thread it was created on.</li>
<li>The client API does not let you remove individual services. If you need to do this create a seperate <a class="el" href="structadbus__State.html" title="Helper class to manage connection services (binds, matches and replies).">adbus_State</a> with only that service and then reset it to remove the service.</li>
</ul>
<p>For example: </p>
<div class="fragment"><pre class="fragment">  <span class="keyword">struct </span>Foo
  {
      <a class="code" href="structadbus__State.html" title="Helper class to manage connection services (binds, matches and replies).">adbus_State</a>* state;
  };

  <span class="keyword">struct </span>Foo* CreateFoo()
  {
      <span class="keyword">struct </span>Foo* f = (<span class="keyword">struct </span>Foo*) calloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> Foo), 1);
      f-&gt;state = adbus_state_new();
      <span class="keywordflow">return</span> f;
  }

  <span class="keywordtype">void</span> DeleteFoo(<span class="keyword">struct</span> Foo* f)
  {
      <span class="keywordflow">if</span> (f) {
          <a class="code" href="structadbus__State.html#ac47884342f82ecf834948ef0f382950d" title="Frees the state, removing all services.">adbus_state_free</a>(f-&gt;state);
          free(f);
      }
  }

  <span class="keyword">static</span> <span class="keywordtype">int</span> SomeCallback(<a class="code" href="structadbus__CbData.html" title="Data structure used for message callbacks.">adbus_CbData</a>* d)
  {
      <span class="keyword">struct </span>Foo* f = (<span class="keyword">struct </span>Foo*) d-&gt;<a class="code" href="structadbus__CbData.html#add762ce3f14ba8978cbcd17d74d6232f" title="First user data variable.">user1</a>;
      <span class="comment">// Do something</span>
      <span class="keywordflow">return</span> 0;
  }

  <span class="keywordtype">void</span> AddMatch(<span class="keyword">struct</span> Foo* f, <a class="code" href="structadbus__Connection.html" title="Client message dispatcher.">adbus_Connection</a>* c)
  {
      <a class="code" href="structadbus__Match.html" title="Data structure used to register general matches.">adbus_Match</a> m;      
      adbus_match_init(&amp;m);
      m.<a class="code" href="structadbus__Match.html#a617f3de6430a50e806d1465db6aaa1e7" title="Sender field to match or NULL (default).">sender</a>    = <span class="stringliteral">&quot;com.example.ExampleService&quot;</span>;
      m.<a class="code" href="structadbus__Match.html#a50c6afdfe9502c45c99bf8644aa4f036" title="Object path field to match or NULL (default).">path</a>      = <span class="stringliteral">&quot;/&quot;</span>;
      m.<a class="code" href="structadbus__Match.html#acde7c9663fbf17ab344c783a6317aa93" title="Member field to match or NULL (default).">member</a>    = <span class="stringliteral">&quot;ExampleSignal&quot;</span>;
      m.<a class="code" href="structadbus__Match.html#a80a7a68c949940fe1229f5b2e067b108" title="Function to call when a message matches the supplied fields.">callback</a>  = &amp;SomeCallback;
      m.<a class="code" href="structadbus__Match.html#aeb9a122878c7b6ff8bbb81077180a924" title="User data for the adbus_Match::callback function.">cuser</a>     = f;

      <a class="code" href="structadbus__State.html#acdd34e51f63d21698954854c140f49b3" title="Adds a match to the supplied connection.">adbus_state_addmatch</a>(f-&gt;state, c, &amp;m);
  }
</pre></div><dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="structadbus__Proxy.html" title="Helper class to access members of a specific remote object.">adbus_Proxy</a> </dd></dl>
<hr/><h2>Friends And Related Function Documentation</h2>
<a class="anchor" id="acdd34e51f63d21698954854c140f49b3"></a><!-- doxytag: member="adbus_State::adbus_state_addmatch" ref="acdd34e51f63d21698954854c140f49b3" args="(adbus_State *s, adbus_Connection *c, const adbus_Match *m)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void adbus_state_addmatch </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structadbus__State.html">adbus_State</a> *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structadbus__Connection.html">adbus_Connection</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structadbus__Match.html">adbus_Match</a> *&nbsp;</td>
          <td class="paramname"> <em>m</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [related]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Adds a match to the supplied connection. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>The proxy and relproxy fields must not be set. They will be overwritten by proxy methods to proxy messages to the local thread.</dd></dl>
<dl class="warning"><dt><b>Warning:</b></dt><dd>This must be called on the state's local thread.</dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd>adbus_conn_addmatch() </dd></dl>

</div>
</div>
<a class="anchor" id="a66d239bfac789558e23ad20bd2ead98f"></a><!-- doxytag: member="adbus_State::adbus_state_addreply" ref="a66d239bfac789558e23ad20bd2ead98f" args="(adbus_State *s, adbus_Connection *c, const adbus_Reply *r)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void adbus_state_addreply </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structadbus__State.html">adbus_State</a> *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structadbus__Connection.html">adbus_Connection</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structadbus__Reply.html">adbus_Reply</a> *&nbsp;</td>
          <td class="paramname"> <em>r</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [related]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Adds a reply to the supplied connection. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>The proxy and relproxy fields must not be set. They will be overwritten by proxy methods to proxy messages to the local thread.</dd></dl>
<dl class="warning"><dt><b>Warning:</b></dt><dd>This must be called on the state's local thread.</dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd>adbus_conn_addreply() </dd></dl>

</div>
</div>
<a class="anchor" id="a96888088138e535b9437b2b1d8d4c7c7"></a><!-- doxytag: member="adbus_State::adbus_state_bind" ref="a96888088138e535b9437b2b1d8d4c7c7" args="(adbus_State *s, adbus_Connection *c, const adbus_Bind *b)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void adbus_state_bind </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structadbus__State.html">adbus_State</a> *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structadbus__Connection.html">adbus_Connection</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structadbus__Bind.html">adbus_Bind</a> *&nbsp;</td>
          <td class="paramname"> <em>b</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [related]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Adds a binding to the supplied connection. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>The proxy and relproxy fields must not be set. They will be overwritten by proxy methods to proxy messages to the local thread.</dd></dl>
<dl class="warning"><dt><b>Warning:</b></dt><dd>This must be called on the state's local thread.</dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd>adbus_conn_bind() </dd></dl>

</div>
</div>
<a class="anchor" id="a8acf9818f655368f1399257a05f5aa62"></a><!-- doxytag: member="adbus_State::adbus_state_reset" ref="a8acf9818f655368f1399257a05f5aa62" args="(adbus_State *s)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void adbus_state_reset </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structadbus__State.html">adbus_State</a> *&nbsp;</td>
          <td class="paramname"> <em>s</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [related]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Resets the state, removing all services. </p>
<p>This will not free the state, so it is ready for reuse.</p>
<dl class="warning"><dt><b>Warning:</b></dt><dd>This must be called on the state's local thread. </dd></dl>

</div>
</div>
<hr/>The documentation for this struct was generated from the following file:<ul>
<li>adbus/state.c</li>
</ul>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on Mon Mar 22 00:10:02 2010 for adbus by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
